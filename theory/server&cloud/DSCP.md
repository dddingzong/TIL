# DSCP TIL

<hr>

## DSCP란?

**Differentiated Services Code Point** : 패킷의 우선순위를 결정하는 QoS(Quality of Service) 메커니즘

* IP 헤더의 ToS(Type of Service) 필드 내 6비트를 사용하여 패킷의 처리 우선순위를 정의한다.
* 네트워크 혼잡 상황에서 중요한 트래픽을 우선적으로 전송할 수 있게 해주는 기술이다.

<hr>

## DSCP가 필요한 이유

### 1. 네트워크 혼잡 관리
* 대역폭이 제한된 상황에서 중요한 트래픽의 전송 품질을 보장한다.
* VoIP, 화상회의, 실시간 스트리밍 같은 지연에 민감한 애플리케이션의 성능을 향상시킨다.

### 2. 서비스 품질 차별화
* 기업 환경에서 중요한 업무용 트래픽과 일반적인 웹 브라우징을 구분하여 처리할 수 있다.
* 서비스 수준 협약(SLA)에 따른 차별화된 서비스 제공이 가능하다.

<hr>

## DSCP 값과 PHB(Per-Hop Behavior)

### 주요 DSCP 클래스

#### 1. Default (BE - Best Effort)
* **DSCP 값**: 0 (000000)
* **특징**: 기본적인 패킷 전송, 특별한 처리 없음
* **사용 사례**: 일반 웹 브라우징, 이메일

#### 2. Expedited Forwarding (EF)
* **DSCP 값**: 46 (101110)
* **특징**: 최우선 처리, 낮은 지연과 지터 보장
* **사용 사례**: VoIP 음성 트래픽, 실시간 통신

#### 3. Assured Forwarding (AF)
* **4개 클래스 × 3개 우선순위** = 12개 AFxy 조합
* **형식**: AFxy (x: 클래스 1-4, y: 우선순위 1-3)

**AF 클래스 예시:**
* **AF11** (DSCP 10): 낮은 우선순위, 낮은 폐기 확률
* **AF31** (DSCP 26): 높은 우선순위, 낮은 폐기 확률
* **AF43** (DSCP 38): 최고 우선순위, 높은 폐기 확률

#### 4. Class Selector (CS)
* **IPv4 Precedence와의 호환성**을 위한 클래스
* **CS0** (0): Best Effort와 동일
* **CS7** (56): 네트워크 제어 트래픽 (라우팅 프로토콜)

<hr>

## 네트워크 장비에서의 DSCP 처리

### 1. 패킷 분류 (Classification)
```
들어오는 패킷 → DSCP 값 확인 → 해당하는 큐에 배치
```

### 2. 큐 스케줄링 (Queue Scheduling)
* **Priority Queuing**: 높은 우선순위 큐를 먼저 처리
* **Weighted Fair Queuing**: 가중치에 따라 대역폭 분배
* **Class-Based Weighted Fair Queuing**: 클래스별 대역폭 보장

### 3. 혼잡 관리 (Congestion Management)
* **WRED** (Weighted Random Early Detection): DSCP 값에 따라 차등적으로 패킷 폐기
* 높은 우선순위 트래픽은 폐기 확률을 낮게 설정

<hr>

## 실무에서의 활용 방안

### 1. 기업 네트워크 QoS 설계
* **중요도에 따른 트래픽 분류**: 업무용 > 인터넷 > 개인용
* **대역폭 할당**: EF 20%, AF31 40%, BE 40%
* **SLA 준수**: 핵심 업무 애플리케이션의 성능 보장

### 2. 클라우드 서비스 최적화
* **멀티 클라우드 환경**에서 중요한 데이터 전송 우선순위 설정
* **CDN과의 연동**으로 컨텐츠 배포 최적화
* **마이크로서비스** 간 통신에서 중요도별 트래픽 처리

### 3. IoT 및 실시간 시스템
* **센서 데이터**: 중요도에 따라 AF 클래스 차등 적용
* **제어 신호**: EF 클래스로 최우선 처리
* **모니터링 데이터**: BE 클래스로 일반 처리

<hr>

## DSCP 구현 시 고려사항

### 1. End-to-End QoS
* **모든 네트워크 구간**에서 DSCP를 지원해야 효과적이다.
* 중간 경로의 라우터 하나라도 DSCP를 무시하면 QoS 효과가 반감된다.

### 2. 트래픽 엔지니어링과의 연계
* **MPLS TE**와 연동하여 더 정교한 경로 제어 가능
* **SDN 환경**에서는 컨트롤러를 통한 동적 QoS 정책 적용

### 3. 보안 고려사항
* **DSCP 스푸핑** 방지: 신뢰할 수 없는 네트워크에서 들어오는 DSCP 값 재설정
* **정책 일관성**: 네트워크 전체에서 일관된 DSCP 정책 적용

<hr>

## 결론

DSCP는 현대 네트워크에서 QoS 구현의 핵심 기술이다.

특히 실시간 애플리케이션이 늘어나고 네트워크 트래픽이 다양해지는 환경에서,
DSCP를 통한 차별화된 서비스 제공은 필수적이라고 생각한다.

앞으로 클라우드 네이티브 애플리케이션을 설계할 때 DSCP를 활용한 
네트워크 QoS 설계를 고려해봐야겠다. 특히 마이크로서비스 간 통신에서
중요도별로 트래픽을 분류하여 처리하면 전체 시스템의 안정성과 성능을 
크게 향상시킬 수 있을 것 같다.